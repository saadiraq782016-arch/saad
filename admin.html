<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - ØªÙƒØ³ÙŠ Ø§Ù„Ø¹Ø±Ø§Ù‚ Ø§Ù„Ø´Ø§Ù…Ù„</title>
<style>
body{font-family:Tahoma;background:#fff;margin:0;padding:20px;color:#222}
h1{color:#2e7d32;text-align:center}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#ffeb3b}
button{padding:6px 8px;border:0;border-radius:6px;cursor:pointer}
.btn-edit{background:#4caf50;color:#fff}
.btn-delete{background:#e53935;color:#fff}
.btn-ban{background:#f44336;color:#fff}
.btn-unban{background:#757575;color:#fff}
.small{font-size:12px;color:#555}
input,select{padding:5px;margin:3px}
</style>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
  <h1>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>

  <div>
    <input id="searchPhone" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..." style="padding:8px;width:220px"/>
    <button onclick="loadUsers()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
  </div>

  <table id="usersTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„</th>
        <th>Ø£ÙŠØ§Ù… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</th>
        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="editor" style="display:none;margin-top:16px;padding:12px;border:1px solid #eee;background:#fafafa">
    <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
    <div>ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: <span id="edtPhone"></span></div>
    <div style="margin-top:8px">
      <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨:
        <select id="edtType">
          <option value="rider">Ø±Ø§ÙƒØ¨</option>
          <option value="driver">Ø³Ø§Ø¦Ù‚</option>
        </select>
      </label>
    </div>
    <div style="margin-top:8px">
      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª: <input id="edtNote" style="width:300px" /></label>
    </div>
    <div style="margin-top:8px">
      <label>ØªÙØ¹ÙŠÙ„ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…: <input type="number" id="edtDays" value="30" min="1" style="width:80px"/> ÙŠÙˆÙ…</label>
    </div>
    <div style="margin-top:8px">
      <button onclick="saveUser()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
      <button onclick="hideEditor()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyBZy7GTKn62CqeXAgm2fLrXI67P4Lc4Q3M",
  authDomain:"taxi-15314.firebaseapp.com",
  databaseURL:"https://taxi-15314-default-rtdb.firebaseio.com/",
  projectId:"taxi-15314"
};
const app=firebase.initializeApp(firebaseConfig);
const db=firebase.database();

async function loadUsers(){
  const q=document.getElementById('searchPhone').value.trim();
  const snap=await db.ref('users').once('value');
  const users=snap.val()||{};
  const tbody=document.querySelector('#usersTable tbody');
  tbody.innerHTML='';
  Object.keys(users).forEach(phone=>{
    if(q && !phone.includes(q))return;
    const u=users[phone];
    const status=u.banned?'Ù…Ø­Ø¸ÙˆØ±':'Ù†Ø´Ø·';
    const expire=u.expireAt?new Date(u.expireAt).toLocaleDateString('ar-IQ'):'â€”';
    const daysLeft=u.expireAt?Math.ceil((new Date(u.expireAt)-new Date())/(1000*60*60*24)):'â€”';
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${phone}</td>
      <td>${u.type||'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
      <td class="small">${u.createdAt?u.createdAt.split('T')[0]:'â€”'}</td>
      <td>${status}</td>
      <td>${expire}</td>
      <td>${u.type==='driver'?daysLeft:'â€”'}</td>
      <td>
        <button class="btn-edit" onclick="openEditor('${phone}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn-delete" onclick="deleteUser('${phone}')">Ø­Ø°Ù</button>
        ${u.banned?
          `<button class='btn-unban' onclick="setBan('${phone}',false)">ÙÙƒ Ø§Ù„Ø­Ø¸Ø±</button>`:
          `<button class='btn-ban' onclick="setBan('${phone}',true)">Ø­Ø¸Ø±</button>`
        }
      </td>`;
    tbody.appendChild(tr);
  });
}

function deleteUser(phone){
  if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… '+phone+' ØŸ'))return;
  db.ref('users/'+phone).remove().then(()=>{alert('ØªÙ… Ø§Ù„Ø­Ø°Ù');loadUsers();});
}

function setBan(phone,ban){
  db.ref('users/'+phone+'/banned').set(ban)
  .then(()=>{alert(ban?'ğŸš« ØªÙ… Ø§Ù„Ø­Ø¸Ø±':'âœ… ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø±');loadUsers();});
}

function openEditor(phone){
  db.ref('users/'+phone).once('value').then(s=>{
    const u=s.val()||{};
    document.getElementById('editor').style.display='block';
    document.getElementById('edtPhone').innerText=phone;
    document.getElementById('edtType').value=u.type||'rider';
    document.getElementById('edtNote').value=u.note||'';
    document.getElementById('edtDays').value=30;
  });
}

function hideEditor(){document.getElementById('editor').style.display='none';}

function saveUser(){
  const phone=document.getElementById('edtPhone').innerText.trim();
  const type=document.getElementById('edtType').value;
  const note=document.getElementById('edtNote').value;
  const days=parseInt(document.getElementById('edtDays').value);
  const expire=new Date(); expire.setDate(expire.getDate()+days);
  db.ref('users/'+phone).update({type,note,expireAt:expire.toISOString()})
  .then(()=>{alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');hideEditor();loadUsers();});
}

loadUsers();
</script>
</body>
</html>
